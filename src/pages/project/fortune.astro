---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { Icon } from "astro-icon/components";
import Plicense from "@/components/widgets/Plicense.astro";
import MainCard from "@/components/MainCard.astro";
const urlNow = new URL(Astro.url, Astro.site).href;
const pgTags = [
	{name: "玄学", color: "green" },
	{name: "随机", color: "purple" }
];
---

<BaseLayout title="功能·运势占卜">
	<style>
		@keyframes fade-in {
			from { opacity: 0; transform: translateY(10px); }
			to { opacity: 1; transform: translateY(0); }
		}
		.animate-fade-in {
			animation: fade-in 0.5s ease-out;
		}
		input:focus {
			outline: none;
			ring: 2px solid #8B5CF6;
		}
	</style>
	<MainCard>
		<h1 class="font-bold text-center mb-4 text-3xl text-purple-400">
			今日运势占卜
		</h1>
		<div class="flex flex-col md:flex-row md:items-center md:justify-center gap-2 md:gap-4">
			<input
				type="text"
				placeholder="请输入您的名称"
				class="input input-bordered w-full md:flex-1 pl-10 pr-16 py-2 border-dashed border-teal-500 hover:border-slate-400"
				id="search"
			/>
			<div class="w-full md:w-auto">
				<button class="btn btn-primary btn-outline w-full" id="searchx">
					<label id="searcht">查询！</label>
					<Icon name="material-symbols:database-search" class="w-5 h-5" />
				</button>
			</div>
		</div>
		<br/>
		<MainCard>
			<div class="text-center" id="basic"></div>
			<br/>
		</MainCard>
		<div class="divider my-8">
			<Icon name="lucide:heart-pulse" class="w-10 h-10 text-primary" />
			<strong>崇尚科学，拒绝迷信</strong>
		</div>
		<script>
			// @ts-ignore 
			import { getluck } from "https://cdn.jsdelivr.net/gh/daeroa/nrcdn2@1.48/js/fortune.js";
			function toggle(aa) {
			    const ia = document.getElementById('search'),
					  err = 'border-red-500',  
					  nor = 'border-teal-500'; 
			    if (aa) {
			        ia.classList.remove(nor);
			        ia.classList.add(err);
			    } else {
			        ia.classList.remove(err);
			        ia.classList.add(nor);
			    }
			}
			function executed(){
				const input = document.getElementById("search") as HTMLInputElement;
				const name = input.value;
				if(name.length === 0){
					document.getElementById("searcht").textContent = "请勿留空！";
					document.getElementById('basic').classList.add('hidden');
					toggle(true);
					return;
				}
				document.getElementById("searcht").textContent = "查询！";
				toggle(false);
				document.getElementById('basic').classList.remove('hidden');
				document.getElementById("basic")!.innerHTML = getluck(name).replace(/\n/g, "<br/>");
			}
			document.querySelector("#search")?.addEventListener("keydown", (e: KeyboardEvent) => { if (e.key === "Enter") executed(); return; });
			document.querySelector("#searchx")?.addEventListener("click", executed);
		</script>
		<br />
		<Plicense
			title="功能·运势占卜"
			url={urlNow}
			productionDate="2024-10-08"
			tags={pgTags as Array<{name: string, color: 'red' | 'blue' | 'green' | 'purple' | 'orange' | 'gray'}>}
		/>
	</MainCard>
</BaseLayout>