---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { Icon } from "astro-icon/components";
import MainCard from "@/components/MainCard.astro";
import Plicense from "@/components/widgets/Plicense.astro";
const urlNow = new URL(Astro.url, Astro.site).href;
---

<BaseLayout title="功能·阶级">
	<style>
		@keyframes fade-in {
			from { opacity: 0; transform: translateY(10px); }
			to { opacity: 1; transform: translateY(0); }
		}
		.animate-fade-in {
			animation: fade-in 0.5s ease-out;
		}
		input:focus {
			outline: none;
			ring: 2px solid #8B5CF6;
		}
	</style>
	<MainCard>
		<h1 class="font-bold text-center mb-4 text-3xl text-purple-400">
			生成您的（古代）社会阶级档案
		</h1>
		<div style="text-align: center; display: flex; gap: 8px; align-items: center; justify-content: center">
			<input
				type="text"
				placeholder="请输入您的名称"
				class="input input-bordered pl-10 pr-16 py-2 border-dashed border-teal-500 hover:border-slate-400 flex-1"
				id="search"
			/>
			<div>
				<button class="btn btn-primary btn-outline" id="searchx">
					<label id="searcht">查询！</label>
					<Icon name="material-symbols:database-search" class="w-5 h-5" />
				</button>
			</div>
		</div>
		<br/>
		<MainCard>
			<div id="result" class="hidden flex flex-wrap gap-4"> 
			    <div class="w-full md:w-[calc(50%-8px)] bg-amber-100 p-6 rounded-lg shadow-md"> 
			        <p class="text-emerald-700 text-2xl mb-3">非洲庄园档案</p>
			        <h2 class="text-2xl font-bold mb-4 text-amber-800" id="africaTitle"></h2>
			        <p class="text-sm mb-2 text-amber-700" id="africaHistory"></p>
			        <p class="text-gray-600" id="africaIntro"></p>
			    </div>
			    <div class="w-full md:w-[calc(50%-8px)] bg-blue-100 p-6 rounded-lg shadow-md">
			        <p class="text-orange-600 text-2xl mb-3">印度种姓档案</p>
			        <h2 class="text-2xl font-bold mb-4 text-blue-800" id="indiaTitle"></h2>
			        <p class="text-sm mb-2 text-blue-700" id="indiaHistory"></p>
			        <p class="text-gray-600" id="indiaIntro"></p>
			    </div>
			    <div class="w-full md:w-[calc(50%-8px)] bg-violet-100 p-6 rounded-lg shadow-md">
			        <p class="text-orange-600 text-2xl mb-3">中国阶级档案</p>
			        <h2 class="text-2xl font-bold mb-4 text-violet-800" id="chinaTitle"></h2>
			        <p class="text-sm mb-2 text-violet-700" id="chinaHistory"></p>
			        <p class="text-gray-600" id="chinaIntro"></p>
			    </div>
			    <div class="w-full md:w-[calc(50%-8px)] bg-lime-100 p-6 rounded-lg shadow-md">
			        <p class="text-orange-600 text-2xl mb-3">日本层级档案</p>
			        <h2 class="text-2xl font-bold mb-4 text-lime-800" id="japanTitle"></h2>
			        <p class="text-sm mb-2 text-lime-700" id="japanHistory"></p>
			        <p class="text-gray-600" id="japanIntro"></p>
			    </div>
			</div>
			<br/>
		</MainCard>
		<div class="divider my-8">
			<Icon name="lucide:heart-pulse" class="w-10 h-10 text-primary" />
			<strong>仅供娱乐</strong>
		</div>
		<script>
			// @ts-ignore
			import { rank } from "https://cdn.jsdelivr.net/gh/daeroa/nrcdn2@1.48/js/class.js";
			function toggle(aa) {
			    const ia = document.getElementById('search'),
					  err = 'border-red-500',  
					  nor = 'border-teal-500'; 
			    if (aa) {
			        ia.classList.remove(nor);
			        ia.classList.add(err);
			    } else {
			        ia.classList.remove(err);
			        ia.classList.add(nor);
			    }
			}
			function executed(){
				const input = document.getElementById("search") as HTMLInputElement;
				const name = input.value;
				if(name.length === 0){
					document.getElementById("searcht").textContent = "请勿留空！";
					document.getElementById('result').classList.add('hidden');
					toggle(true);
					return;
				}
				document.getElementById("searcht").textContent = "查询！";
				toggle(false);
				var jj = rank(name);
				document.getElementById('result').classList.remove('hidden');
				const regions = [
					{ prefix: 'a', idPart: 'africa' },
					{ prefix: 'i', idPart: 'india' },
					{ prefix: 'c', idPart: 'china' },
					{ prefix: 'j', idPart: 'japan' }
				], fields = [
					{ elSuffix: 'Title', prop: 'Name' },
					{ elSuffix: 'History', prop: 'Hist' },
					{ elSuffix: 'Intro', prop: 'Intr' }
				];
				regions.forEach(({ prefix, idPart }) => {
					fields.forEach(({ elSuffix, prop }) => {
						const elementId = `${idPart}${elSuffix}`;
						const propName = `${prefix}${prop}`;
						document.getElementById(elementId).textContent = jj[propName];
					});
				});
			}
			document.querySelector("#search")?.addEventListener("keydown", (e: KeyboardEvent) => { if (e.key === "Enter") executed(); return; });
			document.querySelector("#searchx")?.addEventListener("click", executed);
		</script>
		<Plicense
			title="功能·阶级生成 - Southcatsm"
			url={urlNow}
			productionDate="2025-04-17"
		/>
	</MainCard>
</BaseLayout>
	